generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model State {
  id         Int                @id @default(autoincrement())
  name       String             @unique
  code       String             @unique
  districts  District[]
  institutes InstituteProfile[]

  @@index([name])
}

model District {
  id         Int                @id @default(autoincrement())
  name       String
  code       String
  stateId    Int
  cities     City[]
  state      State              @relation(fields: [stateId], references: [id])
  institutes InstituteProfile[]

  @@unique([stateId, name])
  @@index([stateId])
}

model City {
  id         Int                @id @default(autoincrement())
  name       String
  code       String?
  districtId Int
  district   District           @relation(fields: [districtId], references: [id])
  institutes InstituteProfile[]

  @@unique([districtId, name])
  @@index([districtId])
}

model InstituteProfile {
  id                 String            @id @default(cuid())
  instituteCode      String            @unique
  name               String            @unique
  shortName          String            @unique
  yearOfEstb         Int
  logo               String
  instituteHeroImage String
  aboutInstitute     String
  aboutUs            String
  history            String
  mission            String
  vision             String
  principalMessage   String
  principalPhoto     String
  addressLine1       String
  addressLine2       String
  pincode            Int
  stateId            Int
  districtId         Int
  cityId             Int
  contact            String            @unique @db.VarChar(15)
  emailID            String            @unique
  facebookLink       String            @unique
  linkedInLink       String            @unique
  twitterLink        String            @unique
  instagramLink      String            @unique
  youtubeLink        String            @unique
  createdBy          String
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  domains            InstituteDomain[]
  city               City              @relation(fields: [cityId], references: [id])
  district           District          @relation(fields: [districtId], references: [id])
  state              State             @relation(fields: [stateId], references: [id])
  navbarMenus        NavbarMenu[]
  Slider             Slider[]
  User               User[]

  @@index([stateId])
  @@index([districtId])
  @@index([cityId])
}

model NavbarMenu {
  id          String           @id @default(cuid())
  instituteId String
  title       String
  slug        String
  icon        String?
  linkUrl     String?
  isMegaMenu  Boolean          @default(false)
  order       Int
  isActive    Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  institute   InstituteProfile @relation(fields: [instituteId], references: [id], onDelete: Cascade)
  subMenus    NavbarSubMenu[]

  @@index([instituteId])
}

model NavbarSubMenu {
  id          String         @id @default(cuid())
  menuId      String
  title       String
  slug        String
  linkUrl     String?
  hasMegaMenu Boolean        @default(false)
  order       Int
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  megaItems   MegaMenuItem[]
  menu        NavbarMenu     @relation(fields: [menuId], references: [id], onDelete: Cascade)

  @@index([menuId])
}

model MegaMenuItem {
  id          String        @id @default(cuid())
  subMenuId   String
  title       String
  description String?
  icon        String?
  linkUrl     String?
  columnGroup String?
  order       Int
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  subMenu     NavbarSubMenu @relation(fields: [subMenuId], references: [id], onDelete: Cascade)

  @@index([subMenuId])
}

model Event {
  id          String   @id @default(cuid())
  name        String
  description String
  date        DateTime
  imageURL    String[]
  createdAt   DateTime @default(now())
}

model Slider {
  id             String           @id @default(cuid())
  instituteId    String
  title          String
  description    String?
  transition     SliderTransition @default(FADE)
  design         SliderDesign     @default(HERO)
  autoplay       Boolean          @default(true)
  intervalMs     Int              @default(5000)
  showIndicators Boolean          @default(true)
  showArrows     Boolean          @default(true)
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  institute      InstituteProfile @relation(fields: [instituteId], references: [id], onDelete: Cascade)
  items          SliderItem[]

  @@index([instituteId])
}

model SliderItem {
  id           String    @id @default(cuid())
  sliderId     String
  imageUrl     String
  altText      String?
  linkUrl      String?
  openInNewTab Boolean   @default(false)
  isEnabled    Boolean   @default(true)
  sortOrder    Int       @default(0)
  visibleFrom  DateTime?
  visibleTo    DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  slider       Slider    @relation(fields: [sliderId], references: [id], onDelete: Cascade)

  @@index([sliderId])
  @@index([isEnabled])
}

model User {
  id           String            @id @default(cuid())
  clerkUserId  String            @unique
  email        String            @unique
  role         UserRole
  instituteId  String?
  isActive     Boolean           @default(true)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  institute    InstituteProfile? @relation(fields: [instituteId], references: [id])
  userSecurity UserSecurity?
  userSessions UserSession[]

  @@index([instituteId])
}

model InstituteDomain {
  id          String           @id @default(cuid())
  domain      String           @unique
  isPrimary   Boolean          @default(false)
  isActive    Boolean          @default(true)
  instituteId String
  createdAt   DateTime         @default(now())
  institute   InstituteProfile @relation(fields: [instituteId], references: [id], onDelete: Cascade)

  @@index([instituteId])
}

model UserSecurity {
  id            String    @id @default(cuid())
  userId        String    @unique
  forcePassword Boolean   @default(true)
  forceProfile  Boolean   @default(true)
  firstLoginAt  DateTime?

  user User @relation(fields: [userId], references: [id])
}

model UserSession {
  id        String    @id @default(cuid())
  userId    String
  loginAt   DateTime  @default(now())
  logoutAt  DateTime?
  ipAddress String?

  user User @relation(fields: [userId], references: [id])
}

enum SliderTransition {
  FADE
  SLIDE
  ZOOM
  FLIP
  CUBE
  NONE
}

enum SliderDesign {
  HERO
  FULL_WIDTH
  CARD
  MINIMAL
  THUMBNAIL
}

enum UserRole {
  SUPER_ADMIN
  INSTITUTE_ADMIN
  STAFF
}
