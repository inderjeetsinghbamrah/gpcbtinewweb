generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model State {
  id   Int    @id @default(autoincrement())
  name String @unique
  code String @unique

  districts  District[]
  institutes InstituteProfile[]

  @@index([name])
}

model District {
  id   Int    @id @default(autoincrement())
  name String
  code String

  stateId Int
  state   State @relation(fields: [stateId], references: [id], onDelete: Restrict)

  institutes InstituteProfile[]

  @@unique([stateId, name])
  @@index([stateId])
}

model InstituteProfile {
  id                 String @id @default(cuid())
  instituteCode      String @unique
  name               String @unique
  yearOfEstb         Int
  logo               String
  instituteHeroImage String
  aboutInstitute     String
  history            String
  mission            String
  vision             String
  principalMessage   String
  principalPhoto     String

  addressLine1 String
  addressLine2 String
  city         String
  pincode      Int

  stateId    Int
  districtId Int

  state    State    @relation(fields: [stateId], references: [id], onDelete: Restrict)
  district District @relation(fields: [districtId], references: [id], onDelete: Restrict)

  contact       String @unique @db.VarChar(15)
  emailID       String @unique
  facebookLink  String @unique
  linkedInLink  String @unique
  twitterLink   String @unique
  instagramLink String @unique
  youtubeLink   String @unique

  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ðŸ”— Relations
  Slider  Slider[]
  domains InstituteDomain[] // âœ… NEW
  User    User[]

  @@index([stateId])
  @@index([districtId])
}

model Event {
  id          String   @id @default(cuid())
  title       String   @unique
  description String
  date        DateTime
  location    String
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

//Slider

enum SliderTransition {
  FADE
  SLIDE
  ZOOM
  FLIP
  CUBE
  NONE
}

enum SliderDesign {
  HERO
  FULL_WIDTH
  CARD
  MINIMAL
  THUMBNAIL
}

model Slider {
  id String @id @default(cuid())

  // ðŸ”— Institute reference
  instituteId String
  institute   InstituteProfile @relation(fields: [instituteId], references: [id], onDelete: Cascade)

  // ðŸ§  Slider configuration
  title       String
  description String?

  transition SliderTransition @default(FADE)
  design     SliderDesign     @default(HERO)

  autoplay       Boolean @default(true)
  intervalMs     Int     @default(5000)
  showIndicators Boolean @default(true)
  showArrows     Boolean @default(true)

  isActive Boolean @default(true)

  // ðŸ“¦ Relations
  items SliderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([instituteId])
}

model SliderItem {
  id String @id @default(cuid())

  sliderId String
  slider   Slider @relation(fields: [sliderId], references: [id], onDelete: Cascade)

  // ðŸ–¼ Image data
  imageUrl String
  altText  String?

  // ðŸ”— Optional CTA
  linkUrl      String?
  openInNewTab Boolean @default(false)

  // ðŸŽ› Control flags
  isEnabled Boolean @default(true)
  sortOrder Int     @default(0)

  // ðŸ•’ Optional scheduling (future-ready)
  visibleFrom DateTime?
  visibleTo   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sliderId])
  @@index([isEnabled])
}

//user

enum UserRole {
  SUPER_ADMIN
  INSTITUTE_ADMIN
  STAFF
}

model User {
  id          String @id @default(cuid())
  clerkUserId String @unique

  email String   @unique
  role  UserRole

  instituteId String?
  institute   InstituteProfile? @relation(fields: [instituteId], references: [id])

  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([instituteId])
}

model InstituteDomain {
  id String @id @default(cuid())

  // Domain mapping
  domain    String  @unique // gpc.ac.in | www.gpc.ac.in | admin.gpc.ac.in
  isPrimary Boolean @default(false)
  isActive  Boolean @default(true)

  // Tenant binding
  instituteId String
  institute   InstituteProfile @relation(fields: [instituteId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([instituteId])
}
